<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èµ„äº§ç®¡ç†ç³»ç»Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-8">
    <div class="bg-white rounded-lg shadow-lg p-6">
      <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ’° æ™ºèƒ½èµ„äº§ç®¡ç†ç³»ç»Ÿ</h1>
      
      <!-- APIé…ç½® -->
      <div class="mb-6 p-4 bg-blue-50 rounded-lg">
        <label class="block mb-2 font-semibold">APIæœåŠ¡å™¨åœ°å€:</label>
        <input 
          type="text" 
          id="apiUrl" 
          class="w-full px-4 py-2 border rounded-lg mb-3"
          placeholder="https://your-app.onrender.com"
        />
        <button 
          onclick="testApi()" 
          class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
        >
          ğŸ” æµ‹è¯•APIè¿æ¥
        </button>
        <button 
          onclick="getGoldPrice()" 
          class="ml-2 px-6 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600"
        >
          ğŸ’° è·å–é‡‘ä»·
        </button>
      </div>

      <!-- ç»“æœæ˜¾ç¤º -->
      <div id="result" class="p-4 bg-gray-50 rounded-lg min-h-[100px]">
        <p class="text-gray-600">ç­‰å¾…æµ‹è¯•...</p>
      </div>

      <!-- ä½¿ç”¨è¯´æ˜ -->
      <div class="mt-6 p-4 bg-green-50 rounded-lg">
        <h3 class="font-semibold mb-2">ğŸ“– ä½¿ç”¨è¯´æ˜ï¼š</h3>
        <ol class="list-decimal list-inside space-y-1 text-sm">
          <li>è¾“å…¥ä½ çš„Render APIåœ°å€ï¼ˆä¾‹å¦‚ï¼šhttps://asset-manager-xxxx.onrender.comï¼‰</li>
          <li>ç‚¹å‡»"æµ‹è¯•APIè¿æ¥"æ£€æŸ¥åç«¯æ˜¯å¦æ­£å¸¸</li>
          <li>ç‚¹å‡»"è·å–é‡‘ä»·"æŸ¥çœ‹å®æ—¶916é‡‘ä»·</li>
          <li>ç¡®è®¤åŠŸèƒ½æ­£å¸¸åï¼Œæˆ‘ä»¬å†æ·»åŠ å®Œæ•´ç•Œé¢</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const savedUrl = localStorage.getItem('apiUrl');
      if (savedUrl) {
        document.getElementById('apiUrl').value = savedUrl;
      }
    });

    async function testApi() {
      const apiUrl = document.getElementById('apiUrl').value.trim();
      if (!apiUrl) {
        alert('è¯·è¾“å…¥APIæœåŠ¡å™¨åœ°å€');
        return;
      }
      localStorage.setItem('apiUrl', apiUrl);
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p class="text-blue-600">â³ æ­£åœ¨è¿æ¥...</p>';
      try {
        const response = await fetch(`${apiUrl}/api/health`);
        const data = await response.json();
        resultDiv.innerHTML = `
          <div class="text-green-600">
            <p class="font-bold mb-2">âœ… APIè¿æ¥æˆåŠŸï¼</p>
            <pre class="text-sm bg-white p-3 rounded">${JSON.stringify(data, null, 2)}</pre>
          </div>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <div class="text-red-600">
            <p class="font-bold">âŒ è¿æ¥å¤±è´¥</p>
            <p class="text-sm mt-2">${error.message}</p>
          </div>
        `;
      }
    }

    async function getGoldPrice() {
      const apiUrl = document.getElementById('apiUrl').value.trim();
      if (!apiUrl) {
        alert('è¯·å…ˆè¾“å…¥APIæœåŠ¡å™¨åœ°å€');
        return;
      }
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p class="text-blue-600">â³ æ­£åœ¨è·å–é‡‘ä»·...</p>';
      try {
        const response = await fetch(`${apiUrl}/api/gold-price`);
        const data = await response.json();
        if (data.success) {
          const prices = data.data;
          resultDiv.innerHTML = `
            <div class="text-green-600">
              <p class="font-bold text-xl mb-3">âœ… 916é‡‘ä»·å·²æ›´æ–°ï¼</p>
              <div class="bg-white p-4 rounded space-y-2">
                <p><span class="font-semibold">é›¶å”®ä»·:</span> RM ${prices.gold_916}/å…‹</p>
                <p><span class="font-semibold">å›æ”¶ä»· (93%):</span> RM ${prices.gold_916_buyback_93}/å…‹</p>
                <p class="text-sm text-gray-600 mt-3">æ›´æ–°æ—¶é—´: ${prices.last_updated}</p>
              </div>
            </div>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="text-red-600"><p>âŒ ${error.message}</p></div>`;
      }
    }
  </script>
</body>
</html>
