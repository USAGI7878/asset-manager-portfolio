<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ’° Smart Asset Management System</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
    }
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { PieChart, Pie, Cell, BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

    // Icons Components
    const RefreshCw = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16"/>
      </svg>
    );

    const Download = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="7 10 12 15 17 10"/>
        <line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
    );

    const Upload = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="17 8 12 3 7 8"/>
        <line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
    );

    const TrendingUp = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
        <polyline points="17 6 23 6 23 12"/>
      </svg>
    );

    const DollarSign = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="1" x2="12" y2="23"/>
        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
      </svg>
    );

    const PlusCircle = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="16"/>
        <line x1="8" y1="12" x2="16" y2="12"/>
      </svg>
    );

    const Edit = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
      </svg>
    );

    const Trash = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"/>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
      </svg>
    );

    const Eye = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
    );

    const EyeOff = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
        <line x1="1" y1="1" x2="23" y2="23"/>
      </svg>
    );

    const FileText = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
        <line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/>
        <polyline points="10 9 9 9 8 9"/>
      </svg>
    );

    const SmartAssetManager = () => {
      // é»˜è®¤æ¼”ç¤ºæ•°æ®
      const defaultAssets = {
        liquid: [
          { id: 1, name: 'ç°é‡‘è´¦æˆ·', value: 5000, category: 'cash', notes: 'ç´§æ€¥å¤‡ç”¨é‡‘' },
          { id: 2, name: 'è‚¡ç¥¨æŠ•èµ„', value: 50000, category: 'stocks', notes: 'US & MY è‚¡ç¥¨' },
          { id: 3, name: 'é»„é‡‘', value: 15000, category: 'gold', notes: '916é‡‘å®ç‰©' },
          { id: 4, name: 'åŸºé‡‘', value: 10000, category: 'investment', notes: 'æŒ‡æ•°åŸºé‡‘' }
        ],
        illiquid: [
          { id: 5, name: 'KWSP (EPF)', value: 25000, category: 'retirement', notes: 'å…¬ç§¯é‡‘' }
        ],
        stocks: {
          malaysia: [
            { symbol: 'TOPGLOV', name: 'Top Glove', shares: 1000, avgPrice: 2.50, currentPrice: 0, exchange: 'MY' },
            { symbol: 'MAYBANK', name: 'Maybank', shares: 500, avgPrice: 8.50, currentPrice: 0, exchange: 'MY' }
          ],
          us: [
            { symbol: 'VOO', name: 'Vanguard S&P 500 ETF', shares: 10, avgPrice: 400, currentPrice: 0, exchange: 'US' },
            { symbol: 'AAPL', name: 'Apple Inc', shares: 5, avgPrice: 150, currentPrice: 0, exchange: 'US' }
          ]
        },
        gold: [
          { id: 1, name: '916é‡‘é¡¹é“¾', weight: 10, buyPrice: 300, notes: 'ç»“å©šçºªå¿µ' },
          { id: 2, name: '916é‡‘æ‰‹é•¯', weight: 15, buyPrice: 310, notes: 'ç”Ÿæ—¥ç¤¼ç‰©' }
        ],
        history: []
      };

      const [assets, setAssets] = useState(defaultAssets);
      const [view, setView] = useState('overview');
      const [loading, setLoading] = useState(false);
      const [showValues, setShowValues] = useState(true);
      const [apiUrl, setApiUrl] = useState('');
      const [goldPrice, setGoldPrice] = useState({ retail: 0, buyback: 0, updated: '' });
      const [forexRate, setForexRate] = useState(4.5);
      const [showAddAsset, setShowAddAsset] = useState(false);
      const [showAddStock, setShowAddStock] = useState(false);
      const [showAddGold, setShowAddGold] = useState(false);
      const [editingAsset, setEditingAsset] = useState(null);
      const fileInputRef = useRef(null);

      // ä»localStorageåŠ è½½æ•°æ®
      useEffect(() => {
        const savedAssets = localStorage.getItem('smartAssets');
        const savedApiUrl = localStorage.getItem('apiUrl');
        
        if (savedAssets) {
          try {
            setAssets(JSON.parse(savedAssets));
          } catch (e) {
            console.error('åŠ è½½æ•°æ®å¤±è´¥', e);
          }
        }
        
        if (savedApiUrl) {
          setApiUrl(savedApiUrl);
        }
      }, []);

      // ä¿å­˜æ•°æ®åˆ°localStorage
      useEffect(() => {
        localStorage.setItem('smartAssets', JSON.stringify(assets));
      }, [assets]);

      useEffect(() => {
        if (apiUrl) {
          localStorage.setItem('apiUrl', apiUrl);
        }
      }, [apiUrl]);

      // è®¡ç®—æ€»èµ„äº§
      const calculateTotalAssets = () => {
        const liquidTotal = assets.liquid.reduce((sum, item) => sum + item.value, 0);
        const illiquidTotal = assets.illiquid.reduce((sum, item) => sum + item.value, 0);
        return liquidTotal + illiquidTotal;
      };

      const calculateLiquidAssets = () => {
        return assets.liquid.reduce((sum, item) => sum + item.value, 0);
      };

      const calculateIlliquidAssets = () => {
        return assets.illiquid.reduce((sum, item) => sum + item.value, 0);
      };

      // APIè°ƒç”¨å‡½æ•°
      const updateGoldPrice = async () => {
        if (!apiUrl) {
          alert('è¯·å…ˆè¾“å…¥APIæœåŠ¡å™¨åœ°å€');
          return;
        }
        
        setLoading(true);
        try {
          const response = await fetch(`${apiUrl}/api/gold-price`);
          const result = await response.json();
          
          if (result.success) {
            setGoldPrice({
              retail: result.data.gold_916,
              buyback: result.data.gold_916_buyback_93,
              updated: result.data.last_updated
            });
            alert(`âœ… é‡‘ä»·å·²æ›´æ–°ï¼\né›¶å”®ä»·ï¼šRM ${result.data.gold_916}/å…‹\nå›æ”¶ä»·ï¼šRM ${result.data.gold_916_buyback_93}/å…‹`);
          }
        } catch (error) {
          alert('âŒ æ— æ³•è¿æ¥åˆ°APIæœåŠ¡å™¨\n' + error.message);
        } finally {
          setLoading(false);
        }
      };

      const updateStockPrice = async (symbol, exchange = 'US') => {
        if (!apiUrl) {
          alert('è¯·å…ˆé…ç½®APIæœåŠ¡å™¨åœ°å€');
          return;
        }
        
        try {
          const response = await fetch(`${apiUrl}/api/stock-price/${symbol}?exchange=${exchange}`);
          const result = await response.json();
          
          if (result.success) {
            return result.data.price;
          }
        } catch (error) {
          console.error('è·å–è‚¡ä»·å¤±è´¥:', error);
        }
        return null;
      };

      const updateAllStockPrices = async () => {
        setLoading(true);
        try {
          const updatedStocks = { ...assets.stocks };
          
          // æ›´æ–°ç¾è‚¡
          for (let stock of updatedStocks.us) {
            const price = await updateStockPrice(stock.symbol, 'US');
            if (price) stock.currentPrice = price;
          }
          
          // æ›´æ–°é©¬è‚¡
          for (let stock of updatedStocks.malaysia) {
            const price = await updateStockPrice(stock.symbol, 'MY');
            if (price) stock.currentPrice = price;
          }
          
          setAssets(prev => ({ ...prev, stocks: updatedStocks }));
          alert('âœ… è‚¡ç¥¨ä»·æ ¼å·²æ›´æ–°ï¼');
        } catch (error) {
          alert('âŒ æ›´æ–°å¤±è´¥: ' + error.message);
        } finally {
          setLoading(false);
        }
      };

      const getForexRate = async () => {
        if (!apiUrl) return;
        
        try {
          const response = await fetch(`${apiUrl}/api/forex-rate?from=USD&to=MYR`);
          const result = await response.json();
          
          if (result.success) {
            setForexRate(result.data.rate);
          }
        } catch (error) {
          console.error('è·å–æ±‡ç‡å¤±è´¥:', error);
        }
      };

      // æ–‡ä»¶æ“ä½œ
      const exportData = () => {
        const dataStr = JSON.stringify(assets, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `èµ„äº§æ•°æ®_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);
      };

      const importData = (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const imported = JSON.parse(e.target.result);
              setAssets(imported);
              alert('âœ… æ•°æ®å¯¼å…¥æˆåŠŸï¼');
            } catch (error) {
              alert('âŒ å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
            }
          };
          reader.readAsText(file);
        }
      };

      const handleStatementUpload = async (event) => {
        const file = event.target.files[0];
        if (!file || !apiUrl) {
          alert('è¯·å…ˆé…ç½®APIæœåŠ¡å™¨åœ°å€');
          return;
        }

        const formData = new FormData();
        formData.append('file', file);
        formData.append('platform', 'moomoo'); // å¯ä»¥æ·»åŠ é€‰æ‹©å™¨

        setLoading(true);
        try {
          const response = await fetch(`${apiUrl}/api/parse-statement`, {
            method: 'POST',
            body: formData
          });
          
          const result = await response.json();
          
          if (result.success) {
            // å¤„ç†è§£æçš„è´¦å•æ•°æ®
            alert('âœ… è´¦å•è§£ææˆåŠŸï¼');
            console.log(result.data);
          }
        } catch (error) {
          alert('âŒ è´¦å•è§£æå¤±è´¥: ' + error.message);
        } finally {
          setLoading(false);
        }
      };

      // èµ„äº§ç®¡ç†å‡½æ•°
      const addAsset = (asset) => {
        const newAsset = {
          ...asset,
          id: Date.now(),
          value: parseFloat(asset.value)
        };
        
        if (asset.type === 'liquid') {
          setAssets(prev => ({
            ...prev,
            liquid: [...prev.liquid, newAsset]
          }));
        } else {
          setAssets(prev => ({
            ...prev,
            illiquid: [...prev.illiquid, newAsset]
          }));
        }
        
        setShowAddAsset(false);
      };

      const updateAsset = (id, type, updatedData) => {
        setAssets(prev => ({
          ...prev,
          [type]: prev[type].map(item => 
            item.id === id ? { ...item, ...updatedData } : item
          )
        }));
        setEditingAsset(null);
      };

      const deleteAsset = (id, type) => {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é¡¹èµ„äº§å—ï¼Ÿ')) {
          setAssets(prev => ({
            ...prev,
            [type]: prev[type].filter(item => item.id !== id)
          }));
        }
      };

      const addStock = (stock) => {
        const newStock = {
          ...stock,
          shares: parseFloat(stock.shares),
          avgPrice: parseFloat(stock.avgPrice),
          currentPrice: 0
        };
        
        const market = stock.exchange === 'US' ? 'us' : 'malaysia';
        
        setAssets(prev => ({
          ...prev,
          stocks: {
            ...prev.stocks,
            [market]: [...prev.stocks[market], newStock]
          }
        }));
        
        setShowAddStock(false);
      };

      const addGold = (gold) => {
        const newGold = {
          ...gold,
          id: Date.now(),
          weight: parseFloat(gold.weight),
          buyPrice: parseFloat(gold.buyPrice)
        };
        
        setAssets(prev => ({
          ...prev,
          gold: [...prev.gold, newGold]
        }));
        
        setShowAddGold(false);
      };

      // å›¾è¡¨æ•°æ®
      const assetDistributionData = [
        { name: 'å¯åŠ¨èµ„äº§', value: calculateLiquidAssets(), color: '#0088FE' },
        { name: 'ä¸å¯åŠ¨èµ„äº§', value: calculateIlliquidAssets(), color: '#00C49F' }
      ];

      const categoryDistributionData = [
        { name: 'ç°é‡‘', value: assets.liquid.filter(a => a.category === 'cash').reduce((s, a) => s + a.value, 0), color: '#0088FE' },
        { name: 'è‚¡ç¥¨', value: assets.liquid.filter(a => a.category === 'stocks').reduce((s, a) => s + a.value, 0), color: '#00C49F' },
        { name: 'é»„é‡‘', value: assets.liquid.filter(a => a.category === 'gold').reduce((s, a) => s + a.value, 0), color: '#FFBB28' },
        { name: 'æŠ•èµ„', value: assets.liquid.filter(a => a.category === 'investment').reduce((s, a) => s + a.value, 0), color: '#FF8042' },
        { name: 'é€€ä¼‘é‡‘', value: calculateIlliquidAssets(), color: '#8884D8' }
      ];

      const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8', '#82CA9D'];

      // æ¸²æŸ“ä¸åŒè§†å›¾
      const renderOverview = () => (
        <div className="space-y-6">
          {/* æ€»èµ„äº§å¡ç‰‡ */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-6 text-white shadow-lg">
              <div className="flex items-center justify-between mb-2">
                <div className="text-sm opacity-90">æ€»èµ„äº§</div>
                <DollarSign size={24} />
              </div>
              <div className="text-3xl font-bold">
                {showValues ? `RM ${calculateTotalAssets().toLocaleString('en-MY', {minimumFractionDigits: 2})}` : '****'}
              </div>
            </div>
            
            <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-6 text-white shadow-lg">
              <div className="flex items-center justify-between mb-2">
                <div className="text-sm opacity-90">å¯åŠ¨èµ„äº§</div>
                <TrendingUp size={24} />
              </div>
              <div className="text-3xl font-bold">
                {showValues ? `RM ${calculateLiquidAssets().toLocaleString('en-MY', {minimumFractionDigits: 2})}` : '****'}
              </div>
              <div className="text-xs mt-2 opacity-80">
                {((calculateLiquidAssets() / calculateTotalAssets()) * 100).toFixed(1)}% æ€»èµ„äº§
              </div>
            </div>
            
            <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white shadow-lg">
              <div className="flex items-center justify-between mb-2">
                <div className="text-sm opacity-90">ä¸å¯åŠ¨èµ„äº§</div>
                <FileText size={24} />
              </div>
              <div className="text-3xl font-bold">
                {showValues ? `RM ${calculateIlliquidAssets().toLocaleString('en-MY', {minimumFractionDigits: 2})}` : '****'}
              </div>
              <div className="text-xs mt-2 opacity-80">
                {((calculateIlliquidAssets() / calculateTotalAssets()) * 100).toFixed(1)}% æ€»èµ„äº§
              </div>
            </div>
          </div>

          {/* å›¾è¡¨ */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="bg-white rounded-lg shadow-lg p-6">
              <h3 className="text-xl font-bold mb-4 text-gray-800">èµ„äº§åˆ†å¸ƒ</h3>
              <ResponsiveContainer width="100%" height={300}>
                <PieChart>
                  <Pie
                    data={assetDistributionData}
                    cx="50%"
                    cy="50%"
                    labelLine={false}
                    label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
                    outerRadius={80}
                    fill="#8884d8"
                    dataKey="value"
                  >
                    {assetDistributionData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={entry.color} />
                    ))}
                  </Pie>
                  <Tooltip formatter={(value) => `RM ${value.toLocaleString('en-MY', {minimumFractionDigits: 2})}`} />
                </PieChart>
              </ResponsiveContainer>
            </div>

            <div className="bg-white rounded-lg shadow-lg p-6">
              <h3 className="text-xl font-bold mb-4 text-gray-800">èµ„äº§ç±»åˆ«åˆ†å¸ƒ</h3>
              <ResponsiveContainer width="100%" height={300}>
                <PieChart>
                  <Pie
                    data={categoryDistributionData.filter(d => d.value > 0)}
                    cx="50%"
                    cy="50%"
                    labelLine={false}
                    label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
                    outerRadius={80}
                    fill="#8884d8"
                    dataKey="value"
                  >
                    {categoryDistributionData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={entry.color} />
                    ))}
                  </Pie>
                  <Tooltip formatter={(value) => `RM ${value.toLocaleString('en-MY', {minimumFractionDigits: 2})}`} />
                </PieChart>
              </ResponsiveContainer>
            </div>
          </div>

          {/* èµ„äº§åˆ—è¡¨ */}
          <div className="bg-white rounded-lg shadow-lg p-6">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-gray-800">å¯åŠ¨èµ„äº§æ˜ç»†</h3>
              <button
                onClick={() => setShowAddAsset(true)}
                className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center gap-2"
              >
                <PlusCircle size={18} /> æ·»åŠ èµ„äº§
              </button>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="border-b">
                    <th className="text-left py-3 px-4">åç§°</th>
                    <th className="text-left py-3 px-4">ç±»åˆ«</th>
                    <th className="text-right py-3 px-4">é‡‘é¢</th>
                    <th className="text-left py-3 px-4">å¤‡æ³¨</th>
                    <th className="text-center py-3 px-4">æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody>
                  {assets.liquid.map(asset => (
                    <tr key={asset.id} className="border-b hover:bg-gray-50">
                      <td className="py-3 px-4">{asset.name}</td>
                      <td className="py-3 px-4">
                        <span className={`px-2 py-1 rounded text-xs ${
                          asset.category === 'cash' ? 'bg-blue-100 text-blue-800' :
                          asset.category === 'stocks' ? 'bg-green-100 text-green-800' :
                          asset.category === 'gold' ? 'bg-yellow-100 text-yellow-800' :
                          'bg-purple-100 text-purple-800'
                        }`}>
                          {asset.category}
                        </span>
                      </td>
                      <td className="py-3 px-4 text-right font-semibold">
                        {showValues ? `RM ${asset.value.toLocaleString('en-MY', {minimumFractionDigits: 2})}` : '****'}
                      </td>
                      <td className="py-3 px-4 text-gray-600 text-sm">{asset.notes || '-'}</td>
                      <td className="py-3 px-4 text-center">
                        <button
                          onClick={() => setEditingAsset({ ...asset, type: 'liquid' })}
                          className="text-blue-500 hover:text-blue-700 mr-2"
                        >
                          <Edit size={18} />
                        </button>
                        <button
                          onClick={() => deleteAsset(asset.id, 'liquid')}
                          className="text-red-500 hover:text-red-700"
                        >
                          <Trash size={18} />
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* ä¸å¯åŠ¨èµ„äº§ */}
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h3 className="text-xl font-bold mb-4 text-gray-800">ä¸å¯åŠ¨èµ„äº§æ˜ç»†</h3>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="border-b">
                    <th className="text-left py-3 px-4">åç§°</th>
                    <th className="text-right py-3 px-4">é‡‘é¢</th>
                    <th className="text-left py-3 px-4">å¤‡æ³¨</th>
                  </tr>
                </thead>
                <tbody>
                  {assets.illiquid.map(asset => (
                    <tr key={asset.id} className="border-b hover:bg-gray-50">
                      <td className="py-3 px-4">{asset.name}</td>
                      <td className="py-3 px-4 text-right font-semibold">
                        {showValues ? `RM ${asset.value.toLocaleString('en-MY', {minimumFractionDigits: 2})}` : '****'}
                      </td>
                      <td className="py-3 px-4 text-gray-600 text-sm">{asset.notes || '-'}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );

      const renderStocks = () => (
        <div className="space-y-6">
          {/* ç¾è‚¡ */}
          <div className="bg-white rounded-lg shadow-lg p-6">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-gray-800">ğŸ‡ºğŸ‡¸ ç¾å›½è‚¡ç¥¨</h3>
              <div className="flex gap-2">
                <button
                  onClick={updateAllStockPrices}
                  disabled={loading}
                  className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:bg-gray-400 flex items-center gap-2"
                >
                  <RefreshCw size={18} className={loading ? 'animate-spin' : ''} />
                  æ›´æ–°ä»·æ ¼
                </button>
                <button
                  onClick={() => setShowAddStock(true)}
                  className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center gap-2"
                >
                  <PlusCircle size={18} /> æ·»åŠ è‚¡ç¥¨
                </button>
              </div>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="border-b">
                    <th className="text-left py-3 px-4">ä»£ç </th>
                    <th className="text-left py-3 px-4">åç§°</th>
                    <th className="text-right py-3 px-4">è‚¡æ•°</th>
                    <th className="text-right py-3 px-4">å¹³å‡æˆæœ¬</th>
                    <th className="text-right py-3 px-4">å½“å‰ä»·</th>
                    <th className="text-right py-3 px-4">æˆæœ¬æ€»é¢</th>
                    <th className="text-right py-3 px-4">å¸‚å€¼</th>
                    <th className="text-right py-3 px-4">æŸç›Š</th>
                  </tr>
                </thead>
                <tbody>
                  {assets.stocks.us.map((stock, idx) => {
                    const totalCost = stock.shares * stock.avgPrice;
                    const marketValue = stock.shares * (stock.currentPrice || stock.avgPrice);
                    const pl = marketValue - totalCost;
                    const plPercent = (pl / totalCost) * 100;
                    
                    return (
                      <tr key={idx} className="border-b hover:bg-gray-50">
                        <td className="py-3 px-4 font-semibold">{stock.symbol}</td>
                        <td className="py-3 px-4">{stock.name}</td>
                        <td className="py-3 px-4 text-right">{stock.shares}</td>
                        <td className="py-3 px-4 text-right">${stock.avgPrice.toFixed(2)}</td>
                        <td className="py-3 px-4 text-right">${(stock.currentPrice || stock.avgPrice).toFixed(2)}</td>
                        <td className="py-3 px-4 text-right">${totalCost.toFixed(2)}</td>
                        <td className="py-3 px-4 text-right font-semibold">${marketValue.toFixed(2)}</td>
                        <td className={`py-3 px-4 text-right font-semibold ${pl >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                          ${pl.toFixed(2)} ({plPercent.toFixed(2)}%)
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>

          {/* é©¬è‚¡ */}
          <div className="bg-white rounded-lg shadow-lg p-6">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-gray-800">ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšè‚¡ç¥¨</h3>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="border-b">
                    <th className="text-left py-3 px-4">ä»£ç </th>
                    <th className="text-left py-3 px-4">åç§°</th>
                    <th className="text-right py-3 px-4">è‚¡æ•°</th>
                    <th className="text-right py-3 px-4">å¹³å‡æˆæœ¬</th>
                    <th className="text-right py-3 px-4">å½“å‰ä»·</th>
                    <th className="text-right py-3 px-4">æˆæœ¬æ€»é¢</th>
                    <th className="text-right py-3 px-4">å¸‚å€¼</th>
                    <th className="text-right py-3 px-4">æŸç›Š</th>
                  </tr>
                </thead>
                <tbody>
                  {assets.stocks.malaysia.map((stock, idx) => {
                    const totalCost = stock.shares * stock.avgPrice;
                    const marketValue = stock.shares * (stock.currentPrice || stock.avgPrice);
                    const pl = marketValue - totalCost;
                    const plPercent = (pl / totalCost) * 100;
                    
                    return (
                      <tr key={idx} className="border-b hover:bg-gray-50">
                        <td className="py-3 px-4 font-semibold">{stock.symbol}</td>
                        <td className="py-3 px-4">{stock.name}</td>
                        <td className="py-3 px-4 text-right">{stock.shares}</td>
                        <td className="py-3 px-4 text-right">RM {stock.avgPrice.toFixed(2)}</td>
                        <td className="py-3 px-4 text-right">RM {(stock.currentPrice || stock.avgPrice).toFixed(2)}</td>
                        <td className="py-3 px-4 text-right">RM {totalCost.toFixed(2)}</td>
                        <td className="py-3 px-4 text-right font-semibold">RM {marketValue.toFixed(2)}</td>
                        <td className={`py-3 px-4 text-right font-semibold ${pl >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                          RM {pl.toFixed(2)} ({plPercent.toFixed(2)}%)
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );

      const renderGold = () => (
        <div className="space-y-6">
          {/* é‡‘ä»·ä¿¡æ¯ */}
          <div className="bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-lg shadow-lg p-6 text-white">
            <div className="flex justify-between items-start mb-4">
              <div>
                <h3 className="text-2xl font-bold mb-2">916é‡‘ä»·</h3>
                {goldPrice.updated && (
                  <p className="text-sm opacity-90">æ›´æ–°æ—¶é—´: {goldPrice.updated}</p>
                )}
              </div>
              <button
                onClick={updateGoldPrice}
                disabled={loading}
                className="px-4 py-2 bg-white text-yellow-600 rounded-lg hover:bg-gray-100 flex items-center gap-2"
              >
                <RefreshCw size={18} className={loading ? 'animate-spin' : ''} />
                æ›´æ–°é‡‘ä»·
              </button>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="bg-white bg-opacity-20 rounded-lg p-4">
                <div className="text-sm opacity-90">é›¶å”®ä»·</div>
                <div className="text-3xl font-bold">
                  {goldPrice.retail > 0 ? `RM ${goldPrice.retail.toFixed(2)}` : 'æœªæ›´æ–°'}
                </div>
                <div className="text-xs mt-1">æ¯å…‹</div>
              </div>
              <div className="bg-white bg-opacity-20 rounded-lg p-4">
                <div className="text-sm opacity-90">å›æ”¶ä»· (93%)</div>
                <div className="text-3xl font-bold">
                  {goldPrice.buyback > 0 ? `RM ${goldPrice.buyback.toFixed(2)}` : 'æœªæ›´æ–°'}
                </div>
                <div className="text-xs mt-1">æ¯å…‹</div>
              </div>
            </div>
          </div>

          {/* é»„é‡‘æŒä»“ */}
          <div className="bg-white rounded-lg shadow-lg p-6">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-gray-800">é»„é‡‘æŒä»“</h3>
              <button
                onClick={() => setShowAddGold(true)}
                className="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 flex items-center gap-2"
              >
                <PlusCircle size={18} /> æ·»åŠ é»„é‡‘
              </button>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="border-b">
                    <th className="text-left py-3 px-4">åç§°</th>
                    <th className="text-right py-3 px-4">é‡é‡(å…‹)</th>
                    <th className="text-right py-3 px-4">è´­ä¹°ä»·</th>
                    <th className="text-right py-3 px-4">æˆæœ¬</th>
                    <th className="text-right py-3 px-4">å½“å‰ä»·å€¼</th>
                    <th className="text-right py-3 px-4">æŸç›Š</th>
                    <th className="text-left py-3 px-4">å¤‡æ³¨</th>
                  </tr>
                </thead>
                <tbody>
                  {assets.gold.map(item => {
                    const cost = item.weight * item.buyPrice;
                    const currentValue = goldPrice.buyback > 0 ? item.weight * goldPrice.buyback : cost;
                    const pl = currentValue - cost;
                    const plPercent = (pl / cost) * 100;
                    
                    return (
                      <tr key={item.id} className="border-b hover:bg-gray-50">
                        <td className="py-3 px-4">{item.name}</td>
                        <td className="py-3 px-4 text-right">{item.weight}</td>
                        <td className="py-3 px-4 text-right">RM {item.buyPrice.toFixed(2)}</td>
                        <td className="py-3 px-4 text-right">RM {cost.toFixed(2)}</td>
                        <td className="py-3 px-4 text-right font-semibold">RM {currentValue.toFixed(2)}</td>
                        <td className={`py-3 px-4 text-right font-semibold ${pl >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                          RM {pl.toFixed(2)} ({plPercent.toFixed(2)}%)
                        </td>
                        <td className="py-3 px-4 text-gray-600 text-sm">{item.notes || '-'}</td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
            
            {/* æ€»è®¡ */}
            {assets.gold.length > 0 && (
              <div className="mt-4 pt-4 border-t">
                <div className="flex justify-between items-center font-bold">
                  <span>æ€»è®¡:</span>
                  <div className="text-right">
                    <div>æ€»é‡é‡: {assets.gold.reduce((sum, item) => sum + item.weight, 0).toFixed(2)}å…‹</div>
                    <div>æ€»æˆæœ¬: RM {assets.gold.reduce((sum, item) => sum + (item.weight * item.buyPrice), 0).toFixed(2)}</div>
                    {goldPrice.buyback > 0 && (
                      <div className="text-green-600">
                        å½“å‰ä»·å€¼: RM {assets.gold.reduce((sum, item) => sum + (item.weight * goldPrice.buyback), 0).toFixed(2)}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
              <div className="flex justify-between items-center mb-6 flex-wrap gap-4">
                <div>
                  <h1 className="text-3xl font-bold text-gray-800 mb-2">ğŸ’° Smart Asset Management System</h1>
                  <p className="text-gray-600">å¤šå¹³å°èµ„äº§ç®¡ç† Â· å®æ—¶è¡Œæƒ… Â· AIåˆ†æ</p>
                </div>
                <div className="flex gap-2 flex-wrap">
                  <button
                    onClick={() => setShowValues(!showValues)}
                    className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center gap-2"
                    title={showValues ? 'éšè—é‡‘é¢' : 'æ˜¾ç¤ºé‡‘é¢'}
                  >
                    {showValues ? <EyeOff size={20} /> : <Eye size={20} />}
                  </button>
                  <button
                    onClick={exportData}
                    className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center gap-2"
                  >
                    <Download size={20} /> å¯¼å‡º
                  </button>
                  <label className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center gap-2 cursor-pointer">
                    <Upload size={20} /> å¯¼å…¥
                    <input type="file" accept=".json" onChange={importData} className="hidden" />
                  </label>
                  <label className="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 flex items-center gap-2 cursor-pointer">
                    <FileText size={20} /> è´¦å•
                    <input type="file" accept=".xlsx,.xls,.csv,.pdf" onChange={handleStatementUpload} className="hidden" />
                  </label>
                </div>
              </div>

              {/* APIé…ç½® */}
              <div className="mb-4 p-4 bg-blue-50 rounded-lg">
                <label className="block mb-2 text-sm font-semibold text-gray-700">APIæœåŠ¡å™¨åœ°å€:</label>
                <div className="flex gap-2">
                  <input
                    type="text"
                    value={apiUrl}
                    onChange={(e) => setApiUrl(e.target.value)}
                    className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="https://your-app.onrender.com"
                  />
                  <button
                    onClick={getForexRate}
                    className="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600"
                  >
                    è·å–æ±‡ç‡
                  </button>
                </div>
                <p className="mt-2 text-xs text-gray-600">
                  ğŸ’¡ é…ç½®APIæœåŠ¡å™¨åå¯è·å–å®æ—¶è‚¡ä»·ã€é‡‘ä»·å’Œæ±‡ç‡ | å½“å‰æ±‡ç‡: 1 USD = {forexRate.toFixed(4)} MYR
                </p>
              </div>

              {/* å¯¼èˆª */}
              <div className="flex gap-2 overflow-x-auto">
                {['overview', 'stocks', 'gold'].map(tab => (
                  <button
                    key={tab}
                    onClick={() => setView(tab)}
                    className={`px-6 py-2 rounded-lg font-semibold transition-colors ${
                      view === tab
                        ? 'bg-blue-500 text-white'
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    {tab === 'overview' && 'ğŸ“Š æ€»è§ˆ'}
                    {tab === 'stocks' && 'ğŸ“ˆ è‚¡ç¥¨'}
                    {tab === 'gold' && 'ğŸ’ é»„é‡‘'}
                  </button>
                ))}
              </div>
            </div>

            {/* å†…å®¹åŒºåŸŸ */}
            {view === 'overview' && renderOverview()}
            {view === 'stocks' && renderStocks()}
            {view === 'gold' && renderGold()}

            {/* æ·»åŠ èµ„äº§å¯¹è¯æ¡† */}
            {showAddAsset && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-lg p-6 max-w-md w-full">
                  <h3 className="text-xl font-bold mb-4">æ·»åŠ èµ„äº§</h3>
                  <form onSubmit={(e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    addAsset({
                      name: formData.get('name'),
                      value: formData.get('value'),
                      category: formData.get('category'),
                      notes: formData.get('notes'),
                      type: formData.get('type')
                    });
                  }}>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-semibold mb-1">åç§°</label>
                        <input name="name" type="text" required className="w-full px-3 py-2 border rounded-lg" />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">é‡‘é¢</label>
                        <input name="value" type="number" step="0.01" required className="w-full px-3 py-2 border rounded-lg" />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">ç±»åˆ«</label>
                        <select name="category" required className="w-full px-3 py-2 border rounded-lg">
                          <option value="cash">ç°é‡‘</option>
                          <option value="stocks">è‚¡ç¥¨</option>
                          <option value="gold">é»„é‡‘</option>
                          <option value="investment">æŠ•èµ„</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">ç±»å‹</label>
                        <select name="type" required className="w-full px-3 py-2 border rounded-lg">
                          <option value="liquid">å¯åŠ¨èµ„äº§</option>
                          <option value="illiquid">ä¸å¯åŠ¨èµ„äº§</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">å¤‡æ³¨</label>
                        <input name="notes" type="text" className="w-full px-3 py-2 border rounded-lg" />
                      </div>
                    </div>
                    <div className="flex gap-2 mt-6">
                      <button type="submit" className="flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        æ·»åŠ 
                      </button>
                      <button type="button" onClick={() => setShowAddAsset(false)} className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                        å–æ¶ˆ
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            {/* æ·»åŠ è‚¡ç¥¨å¯¹è¯æ¡† */}
            {showAddStock && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-lg p-6 max-w-md w-full">
                  <h3 className="text-xl font-bold mb-4">æ·»åŠ è‚¡ç¥¨</h3>
                  <form onSubmit={(e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    addStock({
                      symbol: formData.get('symbol'),
                      name: formData.get('name'),
                      shares: formData.get('shares'),
                      avgPrice: formData.get('avgPrice'),
                      exchange: formData.get('exchange')
                    });
                  }}>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-semibold mb-1">è‚¡ç¥¨ä»£ç </label>
                        <input name="symbol" type="text" required className="w-full px-3 py-2 border rounded-lg" placeholder="VOO, AAPL" />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">è‚¡ç¥¨åç§°</label>
                        <input name="name" type="text" required className="w-full px-3 py-2 border rounded-lg" />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">æŒæœ‰è‚¡æ•°</label>
                        <input name="shares" type="number" step="0.01" required className="w-full px-3 py-2 border rounded-lg" />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">å¹³å‡æˆæœ¬</label>
                        <input name="avgPrice" type="number" step="0.01" required className="w-full px-3 py-2 border rounded-lg" />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">å¸‚åœº</label>
                        <select name="exchange" required className="w-full px-3 py-2 border rounded-lg">
                          <option value="US">ç¾å›½ (US)</option>
                          <option value="MY">é©¬æ¥è¥¿äºš (MY)</option>
                        </select>
                      </div>
                    </div>
                    <div className="flex gap-2 mt-6">
                      <button type="submit" className="flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        æ·»åŠ 
                      </button>
                      <button type="button" onClick={() => setShowAddStock(false)} className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                        å–æ¶ˆ
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            {/* æ·»åŠ é»„é‡‘å¯¹è¯æ¡† */}
            {showAddGold && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-lg p-6 max-w-md w-full">
                  <h3 className="text-xl font-bold mb-4">æ·»åŠ é»„é‡‘</h3>
                  <form onSubmit={(e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    addGold({
                      name: formData.get('name'),
                      weight: formData.get('weight'),
                      buyPrice: formData.get('buyPrice'),
                      notes: formData.get('notes')
                    });
                  }}>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-semibold mb-1">åç§°</label>
                        <input name="name" type="text" required className="w-full px-3 py-2 border rounded-lg" placeholder="916é‡‘é¡¹é“¾" />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">é‡é‡(å…‹)</label>
                        <input name="weight" type="number" step="0.01" required className="w-full px-3 py-2 border rounded-lg" />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">è´­ä¹°ä»·(æ¯å…‹)</label>
                        <input name="buyPrice" type="number" step="0.01" required className="w-full px-3 py-2 border rounded-lg" />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">å¤‡æ³¨</label>
                        <input name="notes" type="text" className="w-full px-3 py-2 border rounded-lg" />
                      </div>
                    </div>
                    <div className="flex gap-2 mt-6">
                      <button type="submit" className="flex-1 px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                        æ·»åŠ 
                      </button>
                      <button type="button" onClick={() => setShowAddGold(false)} className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                        å–æ¶ˆ
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            {/* Footer */}
            <div className="mt-8 text-center text-gray-600 text-sm space-y-2">
              <p className="flex items-center justify-center gap-2">
                <span>ğŸ’¡</span>
                <span>æ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œè¯·å®šæœŸå¯¼å‡ºå¤‡ä»½</span>
              </p>
              <p className="flex items-center justify-center gap-2">
                <span>ğŸ”’</span>
                <span>æ‰€æœ‰æ•°æ®ä»…å­˜å‚¨åœ¨æ‚¨çš„è®¾å¤‡ä¸Šï¼Œå®Œå…¨ç§å¯†å®‰å…¨</span>
              </p>
              <p className="flex items-center justify-center gap-2">
                <span>ğŸ“±</span>
                <span>æ”¯æŒå¤šå¹³å°ï¼šMOOMOO, Webull, é€šç”¨åˆ¸å•†è´¦å•</span>
              </p>
              <p className="mt-4 text-xs text-gray-500">
                Smart Asset Management System v1.0 | Created with â¤ï¸
              </p>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<SmartAssetManager />, document.getElementById('root'));
  </script>
</body>
</html>
